---
title: Building a staking Dapp using dAPIs
sidebarHeader: Guides
sidebarSubHeader:
pageHeader: Guides → Building a staking dApp using dAPIs
path: /guides/dapis/staking-guide/
outline: deep
tags:
  - dapi
  - guides
  - staking
---

<PageHeader/>

# {{$frontmatter.title}}

> dApp to stake Mock Wrapped ETH or any ERC20 token to earn $DAPP Tokens of the
> same equivalent staked value in USD using API3's dAPIs on Polygon Mumbai
> Testnet.

## What is Staking/Yield Farming

Staking or Yield Farming in DeFi is a process in which a user gets rewarded for
providing collateral for liquidity to a protocol or a decentralized app. It
enables users to earn returns on their holdings by staking them to generate
value for an on-chain protocol. This process entails users locking their assets
into a liquidity pool) and earning a share of the revenue generated by the
protocol.

In this guide, we are going to build a simple dapp that allows users to earn
interest on their staked assets. We are going to use API3's dAPIs to calculate
rewards for each user.

User will be able to stake their Mock $WETH Tokens and earn $DAPP Tokens as a
reward on top of it. Tokens used in this guide are just simple openzeppelin
ERC20 implementation. You can switch them out to use any ERC20 tokens you want.

## Using dAPIs to calculate rewards

To send the rewards to each staker, we need to find a way to accurately
calculate the rewards that are proportional to the amount of Mock WETH that they
have staked. In order to do this, we need the current market value of the staked
assets, (in this case, it’s WETH). For that, we’re going to use dAPIs.

Using this dApp, a user will be able to stake/unstake their WETH on the platform
and can earn $DAPP tokens on top of it. The rewards can only be issued by the
owner of the contract.

## Coding the Staking contract

Clone the repo and install all the dependencies

```sh
$ git clone https://github.com/vanshwassan/DeFi-Yield-Farming.git

$ cd DeFi-Yield-Farming/

$ yarn
```

There are 3 main contracts that we’ve used in this project.

- [DappToken.sol](): Basic ERC20 implementation using openzeppelin. The token
  that will be used to give out rewards

- [WETH.sol](): Basic ERC20 implementation using openzeppelin. The token that
  will be used as Mock WETH to be staked on the platform.

- [Staking.sol](): The main contract where we stake, unstake and issue rewards.

To see the Staking contract, head on to [Staking.sol]()

The Staking contract has many functions. Using the contract, any user can:

- Stake DAPP Tokens.
- Unstake DAPP Tokens.

Similarly, the Owner (the address that deployed the contract) can:

- Issue rewards in DAPP to all the stakers.
- Add allowed ERC20 tokens that can be staked on the platform.
- Set dAPIs for the allowed tokens.

Here's a brief explanation of what each function does.

- The `stakeTokens` and `unstakeTokens` are the two essential functions that
  will help us stake or unstake WETH on the platform. Anyone can call these
  functions to stake/unstake their DAPP tokens.

```solidity

```

- `getUserTotalValue` calls the `getUserStakingBalanceEthValue` that calls the
  dAPI to get the latest price of the staked asset.

```solidity

```

- `getUserStakingBalanceEthValue` calculates how many DAPP tokens are needed to
  be sent to the staker when the rewards are issued (When you call the
  `issueReward` function). It sends DAPP of the same equivalent value in USD of
  the staked WETH. It calls the `getTokenEthPrice` function to get the latest
  price of ETH.

```solidity

```

- `getTokenEthPrice` takes in the dAPI name in `bytes32` that we set for WETH
  and DAPP after deploying the staking contract. This function calls the set
  dAPIs to return the latest prices.

```solidity

```

As we’re on a testnet, we are using the [`ETH/USD` dAPI]() and mapping it to the
mock WETH Token we’ve deployed. And for the DAPP Token, as it has no real value,
we’re just gonna map it to the [`USDC/USD` dAPI](). For example - if a user
stakes 1 WETH on the platform, they get around 1550 DAPP when the rewards are
issued (1 ETH = 1550 USD).
